(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{294:function(t,e,n){"use strict";n.r(e);var a=n(13),s=Object(a.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"backup-clear-sh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#backup-clear-sh"}},[t._v("#")]),t._v(" backup_clear.sh")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('#!/bin/bash\n\nyy_21=`date -d \'-20 days\' +%Y`\nmm_21=`date -d \'-20 days\' +%m`\ndd_21=`date -d \'-20 days\' +%d`\n\n\ndate_21=$yy_21$mm_21$dd_21\n\n\n#rm -f $yy"_"$mm"_"$dd"_"*.sql.zip\n#ls -l  $yy"_"$mm"_"$dd"_"*.sql.zip\n#echo  -e  "$yy"_"$mm"_"$dd"\n#echo  -e  $yy"_"$mm"_"$dd\n\nfind /backup/ -maxdepth 1 -name \'*.sql.zip\'| sed \'s/\\/backup\\///g\'   | awk -F\'_\' \'{print $1$2$3}\' | while read line ;do  [  $line -lt $date_21 ] && echo $line >>/home/shanhuifu/monitor/back_remove.txt ;done\n\nwhile read line ; do year=`echo $line | cut -c \'1-4\'`;mouth=`echo $line|cut -c 5-6`;day=`echo $line|cut -c 7-8`;rm -f /backup/$year"_"$mouth"_"$day*.sql.zip;done</home/shanhuifu/monitor/back_remove.txt\n\n>/home/shanhuifu/monitor/back_remove.txt\n')])])]),e("h2",{attrs:{id:"monitor-top-cpu-sh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#monitor-top-cpu-sh"}},[t._v("#")]),t._v(" monitor_top_cpu.sh")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#!/bin/bash\n\nwhile :\ndo\nss=`top -n 1 | grep -v 'mysqld'|sed -n '7,$p' | awk '$10>100{print \"CPU:\"$10,\"COMMAND:\"$13,\"\\t\"}'`\nss_num=`echo $ss|grep 'CPU'|wc -l`\n\n[ $ss_num -ge 1 ] && echo $ss|mail -s \"有进程占用CPU超过100%\" 729100483@qq.com\nss_num=0\nsleep 10\ndone\n")])])]),e("h2",{attrs:{id:"monitor-weixin-xiangshidu-sh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#monitor-weixin-xiangshidu-sh"}},[t._v("#")]),t._v(" monitor_weixin_xiangshidu.sh")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#!/bin/bash\nlast_sync_val=`mysql -u'zwbi_dev' -p'zwbi&Un9pl0' -e 'use zwbi_dev;SELECT max(last_sync_similiarity_timestamp) from weixin;'`\ntime_sync=`echo $last_sync_val|awk '{print $2}'`\ntime_now=`date +%s`\n\naa=$[((time_now)-$time_sync)/3600]\n\n[ $aa -gt 5 ] && echo '周日的相识度检查（粉丝同步）没有成功'|mail -s '周六的相识度检查（粉丝同步）没有成功' 729100483@qq.com 329571457@qq.com\n")])])]),e("h2",{attrs:{id:"monitor-zwbi-sh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#monitor-zwbi-sh"}},[t._v("#")]),t._v(" monitor_zwbi.sh")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#!/bin/bash\ntime1=`date +%s`\ntime2=$[$time1+10]\n\nwhile :\ndo\nsleep 10\n#mysql_code=`mysql -u'zwbi_dev' -p'zwbi&Un9pl0' -e 'show databases'`\n#mysql -u'zwbi_dev' -p'zwbi&Un9pl0' -e 'show databases'\n#time2=`date +%s`\n#time2=$[$time1+10]\ninterval=$[($time2-$time1)%600]\n#interval=$[($time2-$time1)%60]\n\nmysql -u'zwbi_dev' -p'zwbi&Un9pl0' -e 'show databases' &>/home/shanhuifu/monitor/monitor_mysql.txt\nvalue1=`grep -c -e 'Database' -e 'zwbi_dev' -e 'information_schema'  /home/shanhuifu/monitor/monitor_mysql.txt`\n[ $value1 -ne 3 ] && [ $interval -eq 10 ] && `echo BI数据库无法连接|mail -s 'BI数据库无法连接' 729100483@qq.com 329571457@qq.com`\n\nhttp_code=`curl -I bi.wozhangwan.com/public/index | grep ^HTTP | egrep -o '\\<([0-9]{3})\\>'`;\n#[ ${http_code} -ne 200 ] && [ $interval -eq 10 ] && `echo BI主页无法打开|mail -s 'BI主页无法打开' 729100483@qq.com 329571457@qq.com`\n[ ${http_code} -ne 200 ] && service php-fpm restart && [ $interval -eq 10 ] && `echo \"BI主页无法打开 $time2\" |mail -s 'BI主页无法打开' 729100483@qq.com 329571457@qq.com`\n\nif [ ${http_code} -eq 200 ];then\n    curl -v  -d \"phone=13222222222&password=654321\" http://bi.wozhangwan.com/public/doLogin  &>/home/shanhuifu/monitor/monitor_login.txt\n    value2=`grep -c '\"status\":true,\"message\":\"OK\"' /home/shanhuifu/monitor/monitor_login.txt`\n    [ $value2 -ne 1 ] && [ $interval -eq 10 ] && `echo BI主页可以打开但帐号无法登录|mail -s 'BI主页可以打开但帐号无法登录' 729100483@qq.com 329571457@qq.com`\n    rm -f /home/shanhuifu/monitor/monitor_login.txt\nfi\n\nrm -f /home/shanhuifu/monitor/monitor_mysql.txt\ntime2=$[$time2+10]\n[ $value1 -eq 3 ] && [ ${http_code} -eq 200 ] && [ $value2 -eq 1 ] && time1=`date +%s` && time2=$[$time1+10]\n\ndone\n")])])]),e("h2",{attrs:{id:"monitor-seaslog-sh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#monitor-seaslog-sh"}},[t._v("#")]),t._v(" monitor_seaslog.sh")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#!/bin/bash\nsize=`du -hs /seaslog/default/|awk '{print $1}'`\ncount_M=`echo $size|grep -c M$`\ncount_G=`echo $size|grep -c G$`\n\nwhile [ $count_G -eq 1 ];\ndo\nls /seaslog/default/critical.2017* | sort -g  | head -5 | xargs rm -f\nls  /seaslog/default/info.2017*|sort -g | head -5|xargs rm -f\n\nsize=`du -hs /seaslog/default/|awk '{print $1}'`\ncount_G=`echo $size|grep -c G$`\nsleep 10\ndone\n")])])]),e("h2",{attrs:{id:"monitor-ifstat-sh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#monitor-ifstat-sh"}},[t._v("#")]),t._v(" monitor_ifstat.sh")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#!/bin/bash\n\nwhile :\ndo\n    i=0;\n    sum_rate=0;\n    while [ $i -lt  30 ];do\n    /usr/local/ifstat/bin/ifstat -b -i eth1>//home/shanhuifu/monitor/monitor_ifstat.txt &\n    sleep 10\n    ps -ef|grep '[0-9] /usr/local/ifstat/bin/ifstat -b -i eth1'|awk '{print $2}'|xargs kill\n    #tail -1 1.txt |awk '{print \"in:\"$1,\"out:\"$2,\"total:\"$1+$2}'\n    rate=`tail -1 /home/shanhuifu/monitor/monitor_ifstat.txt |awk '{print $1+$2}'|awk -F'.' '{print $1}'`\n    sum_rate=$[$rate+$sum_rate];\n    i=$[$i+1];\n    done\n\navg_rate=$[$sum_rate/30];\n[ $avg_rate -gt 3000 ] &&  echo \"当前5分钟平均流量较大,平均流量值为:$avg_rate\"\"kbps\"|mail -s '当前5分钟平均流量较大' 729100483@qq.com\nrm -f /home/shanhuifu/monitor/monitor_ifstat.txt\nsleep 300\ndone\n")])])]),e("h2",{attrs:{id:"monitor-disk-sh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#monitor-disk-sh"}},[t._v("#")]),t._v(" monitor_disk.sh")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#!/bin/bash\ntime1=`date +%s`\ntime2=$[$time1+600]\nwhile :\ndo\n\nhh=`date +%H`\nmm=`date +%M`\n\n\nvalue=$[($time2-$time1)%18000]\ndf -h | grep -v 'tmpfs' | grep -v '/dev/vdb2' |awk '$5 > 85 {print $0}' >/home/shanhuifu/monitor/monitor_disk.txt\ndf -h | grep -v 'tmpfs' | grep '/dev/vdb2' |awk '$5 > 85 {print $0}' >/home/shanhuifu/monitor/monitor_disk_b.txt\nnum_disk=`egrep -c '/dev/vda1|/dev/vdb1' /home/shanhuifu/monitor/monitor_disk.txt`\nnum_disk_b=`grep -c '/dev/vdb2' /home/shanhuifu/monitor/monitor_disk_b.txt`\n\n\n[ $num_disk -eq 0 ] && [ $num_disk_b -eq 0 ] || [ $num_disk_b -eq 1 -a $hh -eq 23 -a $mm -le 45 ] &&  time1=`date +%s` && time2=$[$time1+600]\n\n[ $num_disk -ge 1 ] && time2=$[$time2+600]  && [ $value -eq 600 ] && `mail -s \"服务器有磁盘使用超过85%阈值\"  729100483@qq.com 329571457@qq.com </home/shanhuifu/monitor/monitor_disk.txt`\n\n#[ $num_disk_b -eq 1 ] && [ $hh -lt 23 ] || [ $hh -eq 23 -a $mm -ge 55 ]  && time2=$[$time2+600]  && [ $value -eq 600 ] && `mail -s \"服务器backup目录使用超过85%阈值,剩余空间已不足15G\"  729100483@qq.com 329571457@qq.com </home/shanhuifu/monitor/monitor_disk_b.txt`\n#[ $hh -lt 23 ] || [ $hh -eq 23 -a $mm -ge 55 ] && [ $num_disk_b -eq 1 ]  && time2=$[$time2+600]  && [ $value -eq 600 ] && `mail -s \"服务器backup目录使用超过85%阈值,剩余空间已不足15G\"  729100483@qq.com 329571457@qq.com </home/shanhuifu/monitor/monitor_disk_b.txt`\n[ $hh -lt 1 ] && [ $num_disk_b -eq 1 ]  && time2=$[$time2+600]  && [ $value -eq 600 ] && `mail -s \"服务器backup目录使用超过85%阈值,剩余空间已不足15G\"  729100483@qq.com 329571457@qq.com </home/shanhuifu/monitor/monitor_disk_b.txt`\n\n\nrm -f /home/shanhuifu/monitor/monitor_disk.txt\nrm -f /home/shanhuifu/monitor/monitor_disk_b.txt\n\nsleep 600\n\ndone\n")])])]),e("h2",{attrs:{id:"monitor-cpu-memory-sh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#monitor-cpu-memory-sh"}},[t._v("#")]),t._v(" monitor_cpu_memory.sh")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#!/bin/bash\nwhile :\ndo\ncpu_utily=`top | head -2 |grep -o 'load average:.*' | awk -F',' '{print $2}'`\nmem=`free -m | grep 'buffers/cache' | awk '{print $4}'`\n\n[[ $cpu_utily > 0.8 ]] &&  `echo CPU使用率过高|mail -s 'CPU使用率过高' 729100483@qq.com 329571457@qq.com`\n[[ $mem < 1024 ]] && `echo  内存使用过高|mail -s '内存使用过高' 729100483@qq.com 329571457@qq.com`\n\nsleep 300\ndone\n")])])]),e("h2",{attrs:{id:"monitor-back-sh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#monitor-back-sh"}},[t._v("#")]),t._v(" monitor_back.sh")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("#!/bin/bash\n\n\nfile_yesterday=`date -d '-1 days' +%F|tr '-' '_'`\nfile_yesterday_count=`ls /backup/$file_yesterday*|wc -l`\n\n\nif [ $file_yesterday_count -eq 0 ];then\n     echo 最近一次的数据库备份没有成功,/backup目录下没有找到相关的备份文件|mail -s '最近一次的数据库备份没有成功' 729100483@qq.com 329571457@qq.com\nfi\n\n")])])])])}),[],!1,null,null,null);e.default=s.exports}}]);